{% extends 'base.html' %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/plist.css' %}">
{% endblock %}

{% block content %}

<div class="playlist-container">
    <h1 class="title">Create New Playlist</h1>
    <form method="post" id="playlistForm">
        {% csrf_token %}
        <!-- Render each form field except the song dropdown -->
        {% for field in form %}
            {% if field.name != 'songs' %}  <!-- Assuming 'songs' is the name of the dropdown field -->
                <div class="form-field">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <p class="help">{{ field.help_text }}</p>
                    {% endif %}
                    {% for error in field.errors %}
                        <p class="error">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}

        <div class="checkbox-list" id="songChecklist">
            <!-- Dynamic checkboxes will be populated here by JavaScript -->
        </div>
        <button type="submit" class="submit-btn">Create Playlist</button>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        function fetchSongsAndPopulateChecklist() {
            fetch('/music/api/songs/')
                .then(response => response.json())
                .then(songs => {
                    const checklistDiv = document.getElementById('songChecklist');

                    songs.forEach(song => {
                        const label = document.createElement('label');
                        label.htmlFor = `song${song.id}`;
                        label.textContent = `${song.title} by ${song.artist}`;

                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.name = 'songs';  // Match this with your Django form field name
                        checkbox.value = song.id;
                        checkbox.id = `song${song.id}`;

                        const div = document.createElement('div');
                        div.classList.add('checkbox-item');
                        div.appendChild(checkbox);
                        div.appendChild(label);

                        checklistDiv.appendChild(div);
                    });
                })
                .catch(error => console.error('Error fetching songs:', error));
        }

        fetchSongsAndPopulateChecklist();
    });
</script>

{% endblock %}
