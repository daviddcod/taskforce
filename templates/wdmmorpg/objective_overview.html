{% extends 'base.html' %}

{% block extra_css %}
<style>
    :root {
        /* Color Scheme with enhanced contrast and modern hues */
        --primary-color: #ffffff;
        --secondary-color: #2a9d8f;
        --background-color: #005a4a;
        --text-color: #000000;
        --accent-color: #e76f51;

        /* Typography with a modern, clean font */
        --font-family: 'Nunito', sans-serif;

        /* Spacing system for consistent margins and paddings */
        --space-xs: 8px;
        --space-sm: 16px;
        --space-md: 24px;
        --space-lg: 32px;
        --space-xl: 40px;

        /* Box Shadows for depth and focus */
        --box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);
        --hover-box-shadow: 0 6px 12px 0 rgba(0, 0, 0, 0.2);
    }

    body {
        font-family: var(--font-family);
        background-color: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: var(--space-md);
        transition: background-color 0.3s;
    }

    .heading {
        color: black;
    }

    main {
        color: rgb(255, 255, 255);
    }

    .main-navigation ul {
        display: flex;
        list-style: none;
        padding-left: 0;
        margin-bottom: var(--space-lg);
    }

    .main-navigation a {
        text-decoration: none;
        color: var(--secondary-color);
        padding: var(--space-sm);
        display: block;
        transition: color 0.3s, background-color 0.3s;
    }

    .main-navigation a:hover, .main-navigation a:focus {
        background-color: var(--primary-color);
        color: rgb(93, 25, 25);
        outline: none;
        border-radius: 12px;
    }

    .grid-container {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: repeat(3, auto);
        gap: var(--space-md);
        padding: var(--space-md);
    }

    .grid-item {
        background: rgb(78, 75, 75);
        padding: var(--space-md);
        box-shadow: var(--box-shadow);
        transition: transform 0.3s, box-shadow 0.3s;
        border-radius: 0px;
    }

    .grid-item:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-box-shadow);
    }

    h1, h2 {
        color: var(--primary-color);
        margin-top: 0;
    }

    @media screen and (min-width: 768px) {
        .grid-container {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media print {
        body {
            color: black;
            background: rgb(138, 119, 119);
        }

        .main-navigation, .grid-item:hover {
            display: none;
        }

        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    }

     /* Additional styles for the table */
     .overview-table {
        width: 100%;
        border-collapse: collapse;
    }

    .overview-table th, .overview-table td {
        border: 0px solid var(--secondary-color);
        padding: var(--space-sm);
        text-align: left;
    }

    .overview-table th {
        background-color: var(--secondary-color);
        color: var(--primary-color);
    }

    .overview-table tbody tr:nth-child(odd) {
        background-color: var(--background-color);
    }

    .overview-table {
    width: 100%;
    border-collapse: separate; /* Allows for rounded corners */
    border-spacing: 0;
    margin-bottom: var(--space-lg);
    box-shadow: var(--box-shadow);
    overflow: hidden; /* Ensures the border-radius applies to children */
}

.overview-table th,
.overview-table td {
    padding: var(--space-sm);
    text-align: left;
    border-bottom: 2px solid var(--background-color); /* Subtle separation */
}

.overview-table th {
    background-color: var(--secondary-color);
    color: black;
    font-size: 1.1em;
    border-top-left-radius: 0px;
    border-top-right-radius: 0px;
}

.overview-table tbody tr {
    transition: background-color 0.3s;
}

.overview-table tbody tr:hover {
    background-color: rgba(42, 157, 143, 0.2); /* Subtle hover effect */
}

.overview-table tbody tr:nth-child(odd) {
    background-color: var(--background-color);
}

/* Responsive adjustments */
@media screen and (max-width: 768px) {
    .overview-table, .overview-table thead, .overview-table tbody, .overview-table th, .overview-table td, .overview-table tr {
        display: block;
    }

    .overview-table thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
    }

    .overview-table tr {
        margin-bottom: var(--space-md);
    }

    .overview-table td {
        /* Behave like "row" */
        position: relative;
        padding-left: 50%;
        text-align: right;
    }

    .overview-table td:before {
        /* Adding a pseudo-element for the labels */
        position: absolute;
        top: 12px;
        left: var(--space-sm);
        width: 45%;
        padding-right: var(--space-sm);
        white-space: nowrap;
        text-align: left;
        font-weight: 600;
        content: attr(data-label); /* Using the data-label attribute */
    }
}

/* Print styles */
@media print {
    .overview-table {
        box-shadow: none;
    }

    .overview-table th, .overview-table td {
        border: 1px solid #000;
    }

    .overview-table th {
        background-color: #fff;
        color: #000;
    }

    .overview-table tbody tr:nth-child(odd) {
        background-color: #fff;
    }
}
.progress-bar-container.level {
    background-color: #1c1c1c; /* Dark background */
    border: 2px solid #4e4e4e; /* Slightly lighter border for a subtle contrast */
    border-radius: 12px; /* Less pronounced rounded corners */
    position: relative;
    padding: 2px; /* Tighter padding for a more compact look */
    box-shadow: inset 0 0 10px #000; /* Inner shadow for depth */
    margin-bottom: 20px;
}

.progress-bar {
    background-color: #606c38; /* Muted green for the filled part, reminiscent of Dark Souls' estus flasks */
    height: 20px;
    border-radius: 10px; /* Slightly rounded corners within the bar */
    box-shadow: 0 2px 4px #000, 0 0 20px #00f; /* Shadow for a 3D effect with lightning effect */
    position: relative;
    overflow: hidden;
    margin: 20px;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
    padding-top: 60px;
}

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

#myBtn {
    border-radius: 4px;
    background-color: var(--secondary-color);
    border: 0px;
    height: 40px;
    width: 160.5vh;
}


</style>
{% endblock %}

{% block content %}
{% load my_custom_filters %}

<div class="progress-bar-container level">
    <div class="progress-bar" style="width: {{ user_profile.calculate_experience_percentage }}%; background-color: #ffc107;">
        <span> {{ user_profile.level }}</span>
    </div>
</div>


<main>
    <table class="overview-table">
        <thead>
            <tr>
                <th class="heading">Priority (Importance)</th>
                <th class="heading">Tasks (Urgency: due_date)</th>
                <th class="heading">Missions (Urgency: due_date)</th>
                <th class="heading">Projects (Urgency: End_Date)</th>
            </tr>
        </thead>
        <tbody>
            {% for rank in ranks %}
                <tr>
                    <td>{{ rank.title }} ({{ rank.points }} points)</td>
                    <td>
                        {% with tasks|priority_filter:rank|exclude_completed as filtered_tasks %}
                            {% for task in filtered_tasks %}
                                <div>
                                    <p>Task:<a href="{% url 'wdm:task_detail' task.id %}">{{ task.title }}</a>                                    </p>
                                    <p>Due Date: {{ task.due_date }} <a href="{% url 'wdm:complete_task' task.id %}">Complete</a>                                    </p>
                                </div>
                            {% empty %}
                                <div>No incomplete tasks for this priority.</div>
                            {% endfor %}
                        {% endwith %}
                    </td>
                    <td>
                        {% with missions|priority_filter:rank as filtered_missions %}
                            {% for mission in filtered_missions %}
                                <div>
                                    <p>Mission: {{ mission.title }}</p>
                                    <p>Due Date: {{ mission.due_date }}</p>
                                </div>
                            {% empty %}

                            {% endfor %}
                        {% endwith %}
                    </td>
                    <td>
                        {% with projects|priority_filter:rank as filtered_projects %}
                            {% for project in filtered_projects %}
                                <div>
                                    <p>Project: {{ project.title }}</p>
                                    <p>End Date: {{ project.end_date }}</p>
                                </div>
                            {% empty %}

                            {% endfor %}
                        {% endwith %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</main>

<button id="myBtn">Create New Task</button>



<!-- Task Creation Modal -->
<div id="taskCreationModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create New Task</h2>
        <form id="taskForm">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title"><br><br>

            <label for="description">Description:</label>
            <textarea id="description" name="description"></textarea><br><br>

            <label for="priority">Priority:</label>
            <select id="priority" name="priority"></select><br><br>

            <label for="environment">Environment:</label>
            <select id="environment" name="environment"></select><br><br>

            <label for="due_date">Due Date:</label>
            <input type="date" id="due_date" name="due_date"><br><br>

            <label for="status">Status:</label>
            <select id="status" name="status">
                <!-- Populate this with status options -->
            </select><br><br>

            <input type="checkbox" id="is_active" name="is_active">
            <label for="is_active">Is Active</label><br><br>

            <input type="submit" value="Create Task">
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function filterTasksByMission(missionId) {
    fetch(`/objectives/mission/${missionId}/`)
        .then(response => response.text())
        .then(html => {
            document.getElementById('tasks').innerHTML = html;
        })
        .catch(error => console.error('Error:', error));
}
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('taskCreationModal');
    
    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");
    
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    
    // When the user clicks the button, open the modal 
    btn.onclick = function() {
        modal.style.display = "block";
    }
    
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
});
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
        function updateCartCount(newCount) {
            $("#cart-count").text(newCount);
        }
    
        // Assuming you have buttons or links with a class 'add-to-cart-button'
        $('.add-to-cart-button').on('click', function() {
            // Your logic to add an item to the cart...
            // On success:
            const newCount = /* get the new cart count from your server */;
            updateCartCount(newCount);
        });
    });
    </script>
    
{% endblock %}
